<html>

<head>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', { 'packages': ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    async function drawChart() {

      let url = "https://api.thingspeak.com/channels/1527800/feeds.json?results=20"

      const fetchResults = await fetch(url);
      const jsonResult = await fetchResults.json();
      const feedsReuslts = jsonResult.feeds;

      let editRows = [['Mittausaika', 'Lämpötila']];

      for (const i in feedsReuslts) {
        editRows.push([feedsReuslts[i].created_at, parseInt(feedsReuslts[i].field1.split('.')[0])]);
      }

      var data = google.visualization.arrayToDataTable(editRows);

      var options = {
        title: 'Lämpötila',
        curveType: 'function',
        legend: { position: 'bottom' }
      };

      var data2 = google.visualization.arrayToDataTable([
        ['Mittausaika', 'Ilmankosteus'],
        ['2004', 50],
        ['2005', 40],
        ['2006', 30],
        ['2007', 30]
      ]);

      var options2 = {
        title: 'Ilmankosteus',
        curveType: 'function',
        legend: { position: 'bottom' }
      };

      var chart = new google.visualization.LineChart(document.getElementById('lampotila'));
      chart.draw(data, options);

      var chart2 = new google.visualization.ColumnChart(document.getElementById('ilmankosteus'));
      chart2.draw(data2, options2);

      var myDelay = 10000;
      var thisDelay = 10000;
      var start = Date.now();

      function startTimer() {
        setTimeout(function () {
          console.log("adasd");
          var actual = Date.now() - start;
          // subtract any extra ms from the delay for the next cycle
          thisDelay = myDelay - (actual - myDelay);
          start = Date.now();
          // start the timer again
          startTimer();
        }, thisDelay);
      }
    }
  </script>
</head>

<body>
  <div id="adad" style="width: 900px"></div>
  <div id="lampotila" style="width: 900px; height: 500px"></div>
  <div id="ilmankosteus" style="width: 900px; height: 500px"></div>
</body>

</html>